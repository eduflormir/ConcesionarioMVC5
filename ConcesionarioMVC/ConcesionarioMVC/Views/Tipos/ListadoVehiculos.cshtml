@model IEnumerable<ConcesionarioMVC.Models.Vehiculos>

@{
    ViewBag.Title = "ListadoVehiculos";
}


<input type="radio" name="rad" id="rMatricula" value="matricula" checked> Matricula
<input type="radio" name="rad" id="rMarca" value="marca"> Marca
<input type="text" id="txtBusqueda" placeholder="Texto a buscar..." />
<input type="button" id="btnBus" value="Buscar" class="btn btn-info" />

<button type="button" id="btnAdd" class="btn btn-info" data-toggle="modal" data-target="#dlgAdd">
    Añadir
</button>


<div id="listado">
    @Html.Partial("_listadoVehiculos", Model)
</div>


<div class="modal fade" id="dlgAdd">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Nuevo Vehiculo</h4>
            </div>
            <div class="modal-body">
                @*Pegar formulario*@
                <input type="text" id="txtIdTipo" placeholder="Id Tipo" />
                <input type="text" id="txtMatricula" placeholder="Matricula" />
                <input type="text" id="txtMarca" placeholder="Marca" />
                <input type="text" id="txtModelo" placeholder="Modelo" />
                <input type="text" id="txtCoste" placeholder="Coste" />
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="btnGuardar">Guardar</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

@section MiJavaScript
{
    <script>

        function alta() {
            var data = {
                idTipo: $("#txtIdTipo").val(),
                matricula: $("#txtMatricula").val(),
                marca: $("#txtMarca").val(),
                modelo: $("#txtModelo").val(),
                coste: $("#txtCoste").val()
            };
            var url = "@Url.Action("Alta")";

            $.ajax({
                url: url,
                data: JSON.stringify(data),
                type: "POST", // puede ser GET
                headers: { "Content-Type": "application/json" },
                dataType: "json",
                success: function(res) {
                    if (res.matricula > 0) {
                        $("#dlgAdd").modal('hide'); // para ocultar el dialogo Modal
                        $("#txtBusqueda").val("");
                        listado();
                    } else {
                        alert("Error al guardar");
                    }
                }
            });
        }

        function listado() {

            var url = "@Url.Action("Buscar")";
            var txt = $("#txtBusqueda").val();
            var parametro;

            if ($("#rMatricula").is(':checked')) {
                parametro = "?matricula=";
            } else {
                parametro = "?marca=";
            }
            console.log(parametro);

            url += parametro + txt; // nombre es quien lo enlaza

            $("#listado").load(encodeURI(url)); // por defecto realiza la carga sobre el listado
            // encodeURI: en caso de usar busqueda con espacio en blanco

        }

        function limpiarFormulario() {
            $("#txtIdTipo").val("");
            $("#txtMatricula").val("");
            $("#txtMarca").val("");
            $("#txtModelo").val("");
            $("#txtCoste").val("");
        }


        $("#btnGuardar").click(alta);

        $("#btnBus").click(listado);

        $("#btnAdd").click(limpiarFormulario);

    </script>
    
}

